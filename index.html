<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gerenciamento de Escala</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAwK935g0qeR4Lhbn_eTgXwkbongPp4QYU",
      authDomain: "coletor-92990.firebaseapp.com",
      databaseURL: "https://coletor-92990-default-rtdb.firebaseio.com",
      projectId: "coletor-92990",
      storageBucket: "coletor-92990.firebasestorage.app",
      messagingSenderId: "591970302569",
      appId: "1:591970302569:web:edcf8e8c6f55729c9340f8",
      measurementId: "G-QJQNMDCHW5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // CRUD para cada entidade
    function adicionarEntrada(caminho, dados) {
      db.ref(caminho).push(dados);
    }

    function atualizarEntrada(caminho, id, dados) {
      db.ref(`${caminho}/${id}`).set(dados);
    }

    function excluirEntrada(caminho, id) {
      db.ref(`${caminho}/${id}`).remove();
    }

    function carregarOpcoes(caminho, selectId) {
      db.ref(caminho).once('value').then(snapshot => {
        const select = document.getElementById(selectId);
        select.innerHTML = '<option value="">Selecione</option>';
        snapshot.forEach(child => {
          const option = document.createElement("option");
          option.value = child.key;
          option.textContent = child.val().nome || child.val().Publicador || child.val().Equipamentos || child.val()."Nome do ponto";
          select.appendChild(option);
        });
      });
    }

    function salvarEscala() {
      const pontoId = document.getElementById('ponto').value;
      const equipamentoId = document.getElementById('equipamento').value;
      const p1 = document.getElementById('p1').value;
      const p2 = document.getElementById('p2').value;
      const p3 = document.getElementById('p3').value;
      const inicio = document.getElementById('inicio').value;
      const fim = document.getElementById('fim').value;

      const dados = {
        ponto: pontoId,
        equipamento: equipamentoId,
        publicadores: [p1, p2, p3].filter(p => p),
        inicio,
        fim
      };

      adicionarEntrada('escalas', dados);
      alert("Escala salva com sucesso!");
    }

    window.onload = () => {
      carregarOpcoes('Publicadores', 'p1');
      carregarOpcoes('Publicadores', 'p2');
      carregarOpcoes('Publicadores', 'p3');
      carregarOpcoes('Equipamentos', 'equipamento');
      carregarOpcoes('Pontos', 'ponto');
    }
  </script>
</head>
<body>
  <h1>Gerenciar Escalas de Serviço</h1>

  <label>Ponto:</label>
  <select id="ponto"></select><br>

  <label>Equipamento:</label>
  <select id="equipamento"></select><br>

  <label>Publicador 1:</label>
  <select id="p1"></select><br>

  <label>Publicador 2:</label>
  <select id="p2"></select><br>

  <label>Publicador 3:</label>
  <select id="p3"></select><br>

  <label>Início:</label>
  <input type="time" id="inicio"><br>

  <label>Fim:</label>
  <input type="time" id="fim"><br><br>

  <button onclick="salvarEscala()">Salvar Escala</button>
</body>
</html>
